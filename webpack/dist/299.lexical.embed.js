"use strict";(self.webpackChunkeditor_webpack=self.webpackChunkeditor_webpack||[]).push([[299],{3299:(e,t,n)=>{n.r(t),n.d(t,{RIGHT_CLICK_IMAGE_COMMAND:()=>q,default:()=>te});var r=n(5544),i=n(5072),o=n.n(i),s=n(7825),a=n.n(s),c=n(7659),l=n.n(c),u=n(5056),d=n.n(u),h=n(540),g=n.n(h),m=n(1113),p=n.n(m),f=n(2756),A={};A.styleTagTransform=p(),A.setAttributes=d(),A.insert=l().bind(null,"head"),A.domAPI=a(),A.insertStyleElement=g(),o()(f.A,A),f.A&&f.A.locals&&f.A.locals;var v,w=n(8031),x=n(1497),y=n(2532),E=n(7744),C=n(4439),b=n(9798),B=n(5793),M=n(7797),I=n(6540),R=n(4848),D=(v=function(e){const t=new URLSearchParams;t.append("code",e);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v;function k(e){const t=e.transform();return null!==t?new Set([t]):new Set}function z({initialEditor:e,children:t,initialNodes:n,initialTheme:r,skipCollabChecks:i}){const o=(0,I.useRef)(!1),s=(0,I.useContext)(C.Gu);null==s&&D(9);const[a,{getTheme:c}]=s,l=(0,I.useMemo)((()=>{const t=r||c()||void 0,i=(0,C.Mx)(s,t);if(void 0!==t&&(e._config.theme=t),e._parentEditor=a,n)for(let t of n){let n=null,r=null;if("function"!=typeof t){const e=t;t=e.replace,n=e.with,r=e.withKlass||null}const i=e._nodes.get(t.getType());e._nodes.set(t.getType(),{exportDOM:i?i.exportDOM:void 0,klass:t,replace:n,replaceWithKlass:r,transforms:k(t)})}else{const t=e._nodes=new Map(a._nodes);for(const[n,r]of t)e._nodes.set(n,{exportDOM:r.exportDOM,klass:r.klass,replace:r.replace,replaceWithKlass:r.replaceWithKlass,transforms:k(r.klass)})}return e._config.namespace=a._config.namespace,e._editable=a._editable,[e,i]}),[]),{isCollabActive:u,yjsDocMap:d}=(0,E.k)(),h=i||o.current||d.has(e.getKey());return(0,I.useEffect)((()=>{h&&(o.current=!0)}),[h]),(0,I.useEffect)((()=>a.registerEditableListener((t=>{e.setEditable(t)}))),[e,a]),(0,R.jsx)(C.Gu.Provider,{value:l,children:!u||h?t:null})}var j=n(4674),N=n(9393),W=n(3105),T=n(8832),P=n(7639),S=n(7501);const _="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPgo8c3ZnIHdpZHRoPSI4MDBweCIgaGVpZ2h0PSI4MDBweCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTIyIDNIMnYxOGgyMHYtMmgtMnYtMmgydi0yaC0ydi0yaDJ2LTJoLTJWOWgyVjdoLTJWNWgyVjN6bS0yIDR2MmgtMnYyaDJ2MmgtMnYyaDJ2MmgtMnYySDRWNWgxNHYyaDJ6bS02IDJoLTJ2MmgtMnYySDh2Mkg2djJoMnYtMmgydi0yaDJ2LTJoMnYyaDJ2LTJoLTJWOXpNNiA3aDJ2Mkg2Vjd6IiBmaWxsPSIjMDAwMDAwIi8+Cjwvc3ZnPg==";var L=n(79),Y=n(8968),H=n(8492),J=n(3653),G=n(1238);function Z(e,t,n){return Math.min(Math.max(e,t),n)}var O={east:1,north:8,south:2,west:4};function V(e){var t=e.onResizeStart,n=e.onResizeEnd,r=e.buttonRef,i=e.imageRef,o=e.maxWidth,s=e.editor,a=e.showCaption,c=e.setShowCaption,l=e.captionsEnabled,u=(0,I.useRef)(null),d=(0,I.useRef)({priority:"",value:"default"}),h=(0,I.useRef)({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),g=s.getRootElement(),m=o||(null!==g?g.getBoundingClientRect().width-20:100),p=null!==g?g.getBoundingClientRect().height-20:100,f=function(e,n){if(s.isEditable()){var r=i.current,o=u.current;if(null!==r&&null!==o){e.preventDefault();var a=r.getBoundingClientRect(),c=a.width,l=a.height,m=(0,W.OV)(r),p=h.current;p.startWidth=c,p.startHeight=l,p.ratio=c/l,p.currentWidth=c,p.currentHeight=l,p.startX=e.clientX/m,p.startY=e.clientY/m,p.isResizing=!0,p.direction=n,function(e){var t=e===O.east||e===O.west,n=e===O.north||e===O.south,r=e&O.north&&e&O.west||e&O.south&&e&O.east,i=t?"ew":n?"ns":r?"nwse":"nesw";null!==g&&g.style.setProperty("cursor","".concat(i,"-resize"),"important"),null!==document.body&&(document.body.style.setProperty("cursor","".concat(i,"-resize"),"important"),d.current.value=document.body.style.getPropertyValue("-webkit-user-select"),d.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))}(n),t(),o.classList.add("image-control-wrapper--resizing"),r.style.height="".concat(l,"px"),r.style.width="".concat(c,"px"),document.addEventListener("pointermove",A),document.addEventListener("pointerup",v)}}},A=function(e){var t=i.current,n=h.current,r=n.direction&(O.east|O.west),o=n.direction&(O.south|O.north);if(null!==t&&n.isResizing){var s=(0,W.OV)(t);if(r&&o){var a=Math.floor(n.startX-e.clientX/s);a=n.direction&O.east?-a:a;var c=Z(n.startWidth+a,100,m),l=c/n.ratio;t.style.width="".concat(c,"px"),t.style.height="".concat(l,"px"),n.currentHeight=l,n.currentWidth=c}else if(o){var u=Math.floor(n.startY-e.clientY/s);u=n.direction&O.south?-u:u;var d=Z(n.startHeight+u,100,p);t.style.height="".concat(d,"px"),n.currentHeight=d}else{var g=Math.floor(n.startX-e.clientX/s);g=n.direction&O.east?-g:g;var f=Z(n.startWidth+g,100,m);t.style.width="".concat(f,"px"),n.currentWidth=f}}},v=function(){var e=i.current,t=h.current,r=u.current;if(null!==e&&null!==r&&t.isResizing){var o=t.currentWidth,s=t.currentHeight;t.startWidth=0,t.startHeight=0,t.ratio=0,t.startX=0,t.startY=0,t.currentWidth=0,t.currentHeight=0,t.isResizing=!1,r.classList.remove("image-control-wrapper--resizing"),null!==g&&g.style.setProperty("cursor","text"),null!==document.body&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",d.current.value,d.current.priority)),n(o,s),document.removeEventListener("pointermove",A),document.removeEventListener("pointerup",v)}};return(0,R.jsxs)("div",{ref:u,children:[!a&&l&&(0,R.jsx)("button",{className:"image-caption-button",ref:r,onClick:function(){c(!a)},children:"Add Caption"}),(0,R.jsx)("div",{className:"image-resizer image-resizer-n",onPointerDown:function(e){f(e,O.north)}}),(0,R.jsx)("div",{className:"image-resizer image-resizer-ne",onPointerDown:function(e){f(e,O.north|O.east)}}),(0,R.jsx)("div",{className:"image-resizer image-resizer-e",onPointerDown:function(e){f(e,O.east)}}),(0,R.jsx)("div",{className:"image-resizer image-resizer-se",onPointerDown:function(e){f(e,O.south|O.east)}}),(0,R.jsx)("div",{className:"image-resizer image-resizer-s",onPointerDown:function(e){f(e,O.south)}}),(0,R.jsx)("div",{className:"image-resizer image-resizer-sw",onPointerDown:function(e){f(e,O.south|O.west)}}),(0,R.jsx)("div",{className:"image-resizer image-resizer-w",onPointerDown:function(e){f(e,O.west)}}),(0,R.jsx)("div",{className:"image-resizer image-resizer-nw",onPointerDown:function(e){f(e,O.north|O.west)}})]})}var X=n(5095),K=n(7147),F=n(7578),U=n(432),$=new Set,q=(0,T.gu)("RIGHT_CLICK_IMAGE_COMMAND");function Q(e){var t=e.altText,n=e.className,r=e.imageRef,i=e.src,o=e.width,s=e.height,a=e.maxWidth,c=e.onError;return function(e){if(!$.has(e))throw new Promise((function(t){var n=new Image;n.src=e,n.onload=function(){$.add(e),t(null)},n.onerror=function(){$.add(e)}}))}(i),(0,R.jsx)("img",{className:n||void 0,src:i,alt:t,ref:r,style:{height:s,maxWidth:a,width:o},onError:c,draggable:"false"})}function ee(){return(0,R.jsx)("img",{src:_,style:{height:200,opacity:.2,width:200},draggable:"false"})}function te(e){var t=e.src,n=e.altText,i=e.nodeKey,o=e.width,s=e.height,a=e.maxWidth,c=e.resizable,l=e.showCaption,u=e.caption,d=e.captionsEnabled,h=(0,I.useRef)(null),g=(0,I.useRef)(null),m=(0,N.Y)(i),p=(0,r.A)(m,3),f=p[0],A=p[1],v=p[2],D=(0,I.useState)(!1),k=(0,r.A)(D,2),_=k[0],Z=k[1],O=((0,E.k)().isCollabActive,(0,C.DF)()),$=(0,r.A)(O,1)[0],te=(0,I.useState)(null),ne=(0,r.A)(te,2),re=ne[0],ie=ne[1],oe=(0,I.useRef)(null),se=(0,I.useState)(!1),ae=(0,r.A)(se,2),ce=ae[0],le=ae[1],ue=(0,I.useCallback)((function(e){if(f&&(0,T.RT)((0,T.vJ)())){e.preventDefault();var t=(0,T.ns)(i);if((0,F.Eh)(t))return t.remove(),!0}return!1}),[f,i]),de=(0,I.useCallback)((function(e){var t=(0,T.vJ)(),n=g.current;if(f&&(0,T.RT)(t)&&1===t.getNodes().length){if(l)return(0,T.n1)(null),e.preventDefault(),u.focus(),!0;if(null!==n&&n!==document.activeElement)return e.preventDefault(),n.focus(),!0}return!1}),[u,f,l]),he=(0,I.useCallback)((function(e){return(oe.current===u||g.current===e.target)&&((0,T.n1)(null),$.update((function(){A(!0);var e=$.getRootElement();null!==e&&e.focus()})),!0)}),[u,$,A]),ge=(0,I.useCallback)((function(e){var t=e;return!!_||t.target===h.current&&(t.shiftKey?A(!f):(v(),A(!0)),!0)}),[_,f,A,v]),me=(0,I.useCallback)((function(e){$.getEditorState().read((function(){var t=(0,T.vJ)();"IMG"===e.target.tagName&&(0,T.I2)(t)&&1===t.getNodes().length&&$.dispatchCommand(q,e)}))}),[$]);(0,I.useEffect)((function(){var e=!0,t=$.getRootElement(),n=(0,W.Sd)($.registerUpdateListener((function(t){var n=t.editorState;e&&ie(n.read((function(){return(0,T.vJ)()})))})),$.registerCommand(T.Mv,(function(e,t){return oe.current=t,!1}),T.Ac),$.registerCommand(T.d8,ge,T.Ac),$.registerCommand(q,ge,T.Ac),$.registerCommand(T.Tg,(function(e){return e.target===h.current&&(e.preventDefault(),!0)}),T.Ac),$.registerCommand(T.w$,ue,T.Ac),$.registerCommand(T.gC,ue,T.Ac),$.registerCommand(T.if,de,T.Ac),$.registerCommand(T.Q$,he,T.Ac));return null==t||t.addEventListener("contextmenu",me),function(){e=!1,n(),null==t||t.removeEventListener("contextmenu",me)}}),[v,$,_,f,i,ue,de,he,ge,me,A]);var pe=(0,S.O)().historyState,fe=((0,P.t)().settings.showNestedEditorTreeView,f&&(0,T.RT)(re)&&!_),Ae=f||_;return(0,R.jsx)(I.Suspense,{fallback:null,children:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{draggable:fe,children:ce?(0,R.jsx)(ee,{}):(0,R.jsx)(Q,{className:Ae?"focused ".concat((0,T.RT)(re)?"draggable":""):null,src:t,altText:n,imageRef:h,width:o,height:s,maxWidth:a,onError:function(){return le(!0)}})}),l&&(0,R.jsx)("div",{className:"image-caption-container",children:(0,R.jsxs)(z,{initialEditor:u,initialNodes:[T.h,T.Ey,T.GR,T.fD,x.Db,K.Hf,w.ZZ,U.UZ],children:[(0,R.jsx)(y.x,{}),(0,R.jsx)(J.A,{}),(0,R.jsx)(H.A,{}),(0,R.jsx)(L.A,{}),(0,R.jsx)(B.E,{}),(0,R.jsx)(Y.A,{}),(0,R.jsx)(M.G,{externalHistoryState:pe}),(0,R.jsx)(j.$,{contentEditable:(0,R.jsx)(G.A,{className:"ImageNode__contentEditable"}),placeholder:(0,R.jsx)(X.A,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:b.R})]})}),c&&(0,T.RT)(re)&&Ae&&(0,R.jsx)(V,{showCaption:l,setShowCaption:function(){$.update((function(){var e=(0,T.ns)(i);(0,F.Eh)(e)&&e.setShowCaption(!0)}))},editor:$,buttonRef:g,imageRef:h,maxWidth:a,onResizeStart:function(){Z(!0)},onResizeEnd:function(e,t){setTimeout((function(){Z(!1)}),200),$.update((function(){var n=(0,T.ns)(i);(0,F.Eh)(n)&&n.setWidthAndHeight(e,t)}))},captionsEnabled:!ce&&d})]})})}},2756:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(1354),i=n.n(r),o=n(6314),s=n.n(o)()(i());s.push([e.id,"/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n *\n */\n\n.ImageNode__contentEditable {\n  min-height: 30px;\n  border: 0px;\n  resize: none;\n  cursor: text;\n  caret-color: rgb(5, 5, 5);\n  display: block;\n  position: relative;\n  outline: 0px;\n  padding: 10px;\n  user-select: text;\n  font-size: 12px;\n  width: calc(100% - 20px);\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n\n.ImageNode__placeholder {\n  font-size: 12px;\n  color: #888;\n  overflow: hidden;\n  position: absolute;\n  text-overflow: ellipsis;\n  top: 10px;\n  left: 10px;\n  user-select: none;\n  white-space: nowrap;\n  display: inline-block;\n  pointer-events: none;\n}\n\n.image-control-wrapper--resizing {\n  touch-action: none;\n}\n","",{version:3,sources:["webpack://./src/LexicalEditor/nodes/ImageNode.css"],names:[],mappings:"AAAA;;;;;;;EAOE;;AAEF;EACE,gBAAgB;EAChB,WAAW;EACX,YAAY;EACZ,YAAY;EACZ,yBAAyB;EACzB,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,aAAa;EACb,iBAAiB;EACjB,eAAe;EACf,wBAAwB;EACxB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,uBAAuB;EACvB,SAAS;EACT,UAAU;EACV,iBAAiB;EACjB,mBAAmB;EACnB,qBAAqB;EACrB,oBAAoB;AACtB;;AAEA;EACE,kBAAkB;AACpB",sourcesContent:["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n *\n */\n\n.ImageNode__contentEditable {\n  min-height: 30px;\n  border: 0px;\n  resize: none;\n  cursor: text;\n  caret-color: rgb(5, 5, 5);\n  display: block;\n  position: relative;\n  outline: 0px;\n  padding: 10px;\n  user-select: text;\n  font-size: 12px;\n  width: calc(100% - 20px);\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n\n.ImageNode__placeholder {\n  font-size: 12px;\n  color: #888;\n  overflow: hidden;\n  position: absolute;\n  text-overflow: ellipsis;\n  top: 10px;\n  left: 10px;\n  user-select: none;\n  white-space: nowrap;\n  display: inline-block;\n  pointer-events: none;\n}\n\n.image-control-wrapper--resizing {\n  touch-action: none;\n}\n"],sourceRoot:""}]);const a=s}}]);
//# sourceMappingURL=299.lexical.embed.js.map