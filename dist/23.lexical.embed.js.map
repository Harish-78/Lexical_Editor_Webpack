{"version":3,"file":"23.lexical.embed.js","mappings":"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","sources":["webpack://editor-webpack/./src/LexicalEditor/ui/EquationEditor.css?03cf","webpack://editor-webpack/./src/LexicalEditor/ui/EquationEditor.tsx","webpack://editor-webpack/./src/LexicalEditor/nodes/EquationComponent.tsx","webpack://editor-webpack/./src/LexicalEditor/ui/EquationEditor.css"],"sourcesContent":["\n      import API from \"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../node_modules/css-loader/dist/cjs.js!./EquationEditor.css\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\noptions.insert = insertFn.bind(null, \"head\");\noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../node_modules/css-loader/dist/cjs.js!./EquationEditor.css\";\n       export default content && content.locals ? content.locals : undefined;\n","/**\r\n * Copyright (c) Meta Platforms, Inc. and affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n */\r\n\r\nimport type { Ref, RefObject } from 'react'\r\n\r\nimport './EquationEditor.css'\r\n\r\nimport * as React from 'react'\r\nimport { ChangeEvent, forwardRef } from 'react'\r\n\r\ntype BaseEquationEditorProps = {\r\n  equation: string\r\n  inline: boolean\r\n  setEquation: (equation: string) => void\r\n}\r\n\r\nfunction EquationEditor(\r\n  { equation, setEquation, inline }: BaseEquationEditorProps,\r\n  forwardedRef: Ref<HTMLInputElement | HTMLTextAreaElement>\r\n): JSX.Element {\r\n  const onChange = (event: ChangeEvent) => {\r\n    setEquation((event.target as HTMLInputElement).value)\r\n  }\r\n\r\n  return inline && forwardedRef instanceof HTMLInputElement ? (\r\n    <span className=\"EquationEditor_inputBackground\">\r\n      <span className=\"EquationEditor_dollarSign\">$</span>\r\n      <input\r\n        className=\"EquationEditor_inlineEditor\"\r\n        value={equation}\r\n        onChange={onChange}\r\n        autoFocus={true}\r\n        ref={forwardedRef as RefObject<HTMLInputElement>}\r\n      />\r\n      <span className=\"EquationEditor_dollarSign\">$</span>\r\n    </span>\r\n  ) : (\r\n    <div className=\"EquationEditor_inputBackground\">\r\n      <span className=\"EquationEditor_dollarSign\">{'$$\\n'}</span>\r\n      <textarea\r\n        className=\"EquationEditor_blockEditor\"\r\n        value={equation}\r\n        onChange={onChange}\r\n        ref={forwardedRef as RefObject<HTMLTextAreaElement>}\r\n      />\r\n      <span className=\"EquationEditor_dollarSign\">{'\\n$$'}</span>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default forwardRef(EquationEditor)\r\n","/**\r\n * Copyright (c) Meta Platforms, Inc. and affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n */\r\n\r\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext'\r\nimport { mergeRegister } from '@lexical/utils'\r\nimport {\r\n  $getNodeByKey,\r\n  $getSelection,\r\n  $isNodeSelection,\r\n  COMMAND_PRIORITY_HIGH,\r\n  KEY_ESCAPE_COMMAND,\r\n  NodeKey,\r\n  SELECTION_CHANGE_COMMAND,\r\n} from 'lexical'\r\nimport * as React from 'react'\r\nimport { useCallback, useEffect, useRef, useState } from 'react'\r\nimport { ErrorBoundary } from 'react-error-boundary'\r\n\r\nimport EquationEditor from '../ui/EquationEditor.tsx'\r\nimport KatexRenderer from '../ui/KatexRenderer.tsx'\r\nimport { $isEquationNode } from './EquationNode.tsx'\r\n\r\ntype EquationComponentProps = {\r\n  equation: string\r\n  inline: boolean\r\n  nodeKey: NodeKey\r\n}\r\n\r\nexport default function EquationComponent({\r\n  equation,\r\n  inline,\r\n  nodeKey,\r\n}: EquationComponentProps): JSX.Element {\r\n  const [editor] = useLexicalComposerContext()\r\n  const [equationValue, setEquationValue] = useState(equation)\r\n  const [showEquationEditor, setShowEquationEditor] = useState<boolean>(false)\r\n  const inputRef = useRef(null)\r\n\r\n  const onHide = useCallback(\r\n    (restoreSelection?: boolean) => {\r\n      setShowEquationEditor(false)\r\n      editor.update(() => {\r\n        const node = $getNodeByKey(nodeKey)\r\n        if ($isEquationNode(node)) {\r\n          node.setEquation(equationValue)\r\n          if (restoreSelection) {\r\n            node.selectNext(0, 0)\r\n          }\r\n        }\r\n      })\r\n    },\r\n    [editor, equationValue, nodeKey]\r\n  )\r\n\r\n  useEffect(() => {\r\n    if (!showEquationEditor && equationValue !== equation) {\r\n      setEquationValue(equation)\r\n    }\r\n  }, [showEquationEditor, equation, equationValue])\r\n\r\n  useEffect(() => {\r\n    if (showEquationEditor) {\r\n      return mergeRegister(\r\n        editor.registerCommand(\r\n          SELECTION_CHANGE_COMMAND,\r\n          (payload) => {\r\n            const activeElement = document.activeElement\r\n            const inputElem = inputRef.current\r\n            if (inputElem !== activeElement) {\r\n              onHide()\r\n            }\r\n            return false\r\n          },\r\n          COMMAND_PRIORITY_HIGH\r\n        ),\r\n        editor.registerCommand(\r\n          KEY_ESCAPE_COMMAND,\r\n          (payload) => {\r\n            const activeElement = document.activeElement\r\n            const inputElem = inputRef.current\r\n            if (inputElem === activeElement) {\r\n              onHide(true)\r\n              return true\r\n            }\r\n            return false\r\n          },\r\n          COMMAND_PRIORITY_HIGH\r\n        )\r\n      )\r\n    } else {\r\n      return editor.registerUpdateListener(({ editorState }) => {\r\n        const isSelected = editorState.read(() => {\r\n          const selection = $getSelection()\r\n          return (\r\n            $isNodeSelection(selection) &&\r\n            selection.has(nodeKey) &&\r\n            selection.getNodes().length === 1\r\n          )\r\n        })\r\n        if (isSelected) {\r\n          setShowEquationEditor(true)\r\n        }\r\n      })\r\n    }\r\n  }, [editor, nodeKey, onHide, showEquationEditor])\r\n\r\n  return (\r\n    <>\r\n      {showEquationEditor ? (\r\n        <EquationEditor\r\n          equation={equationValue}\r\n          setEquation={setEquationValue}\r\n          inline={inline}\r\n          ref={inputRef}\r\n        />\r\n      ) : (\r\n        <ErrorBoundary onError={(e) => editor._onError(e)} fallback={null}>\r\n          <KatexRenderer\r\n            equation={equationValue}\r\n            inline={inline}\r\n            onDoubleClick={() => setShowEquationEditor(true)}\r\n          />\r\n        </ErrorBoundary>\r\n      )}\r\n    </>\r\n  )\r\n}\r\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/**\r\n * Copyright (c) Meta Platforms, Inc. and affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n *\r\n */\r\n\r\n.EquationEditor_inlineEditor {\r\n  padding: 0;\r\n  margin: 0;\r\n  border: 0;\r\n  outline: 0;\r\n  color: #8421a2;\r\n  background-color: inherit;\r\n  resize: none;\r\n}\r\n\r\n.EquationEditor_blockEditor {\r\n  padding: 0;\r\n  margin: 0;\r\n  border: 0;\r\n  outline: 0;\r\n  color: #8421a2;\r\n  background-color: inherit;\r\n  resize: none;\r\n  width: 100%;\r\n}\r\n\r\n.EquationEditor_inputBackground {\r\n  background-color: #eee;\r\n}\r\n\r\n.EquationEditor_dollarSign {\r\n  text-align: left;\r\n  color: #b0b0b0;\r\n}\r\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/LexicalEditor/ui/EquationEditor.css\"],\"names\":[],\"mappings\":\"AAAA;;;;;;;EAOE;;AAEF;EACE,UAAU;EACV,SAAS;EACT,SAAS;EACT,UAAU;EACV,cAAc;EACd,yBAAyB;EACzB,YAAY;AACd;;AAEA;EACE,UAAU;EACV,SAAS;EACT,SAAS;EACT,UAAU;EACV,cAAc;EACd,yBAAyB;EACzB,YAAY;EACZ,WAAW;AACb;;AAEA;EACE,sBAAsB;AACxB;;AAEA;EACE,gBAAgB;EAChB,cAAc;AAChB\",\"sourcesContent\":[\"/**\\r\\n * Copyright (c) Meta Platforms, Inc. and affiliates.\\r\\n *\\r\\n * This source code is licensed under the MIT license found in the\\r\\n * LICENSE file in the root directory of this source tree.\\r\\n *\\r\\n *\\r\\n */\\r\\n\\r\\n.EquationEditor_inlineEditor {\\r\\n  padding: 0;\\r\\n  margin: 0;\\r\\n  border: 0;\\r\\n  outline: 0;\\r\\n  color: #8421a2;\\r\\n  background-color: inherit;\\r\\n  resize: none;\\r\\n}\\r\\n\\r\\n.EquationEditor_blockEditor {\\r\\n  padding: 0;\\r\\n  margin: 0;\\r\\n  border: 0;\\r\\n  outline: 0;\\r\\n  color: #8421a2;\\r\\n  background-color: inherit;\\r\\n  resize: none;\\r\\n  width: 100%;\\r\\n}\\r\\n\\r\\n.EquationEditor_inputBackground {\\r\\n  background-color: #eee;\\r\\n}\\r\\n\\r\\n.EquationEditor_dollarSign {\\r\\n  text-align: left;\\r\\n  color: #b0b0b0;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n"],"names":["options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","locals","EquationEditor","_ref","forwardedRef","equation","setEquation","onChange","event","target","value","inline","HTMLInputElement","_jsxs","className","children","_jsx","autoFocus","ref","forwardRef","EquationComponent","nodeKey","_useLexicalComposerCo","useLexicalComposerContext","editor","_slicedToArray","_useState","useState","_useState2","equationValue","setEquationValue","_useState3","_useState4","showEquationEditor","setShowEquationEditor","inputRef","useRef","onHide","useCallback","restoreSelection","update","node","$getNodeByKey","$isEquationNode","selectNext","useEffect","mergeRegister","registerCommand","SELECTION_CHANGE_COMMAND","payload","activeElement","document","current","COMMAND_PRIORITY_HIGH","KEY_ESCAPE_COMMAND","registerUpdateListener","_ref2","editorState","read","selection","$getSelection","$isNodeSelection","has","getNodes","length","_Fragment","ErrorBoundary","onError","e","_onError","fallback","KatexRenderer","onDoubleClick","___CSS_LOADER_EXPORT___","push","module","id"],"sourceRoot":""}