"use strict";(self.webpackChunkeditor_webpack=self.webpackChunkeditor_webpack||[]).push([[299],{3299:(e,t,n)=>{n.r(t),n.d(t,{RIGHT_CLICK_IMAGE_COMMAND:()=>q,default:()=>te});var r=n(5544),i=n(5072),o=n.n(i),s=n(7825),a=n.n(s),c=n(7659),l=n.n(c),u=n(5056),d=n.n(u),h=n(540),g=n.n(h),p=n(1113),f=n.n(p),m=n(2756),A={};A.styleTagTransform=f(),A.setAttributes=d(),A.insert=l().bind(null,"head"),A.domAPI=a(),A.insertStyleElement=g(),o()(m.A,A),m.A&&m.A.locals&&m.A.locals;var v,w=n(8031),x=n(1497),C=n(2532),y=n(7744),E=n(4439),b=n(9798),B=n(5793),M=n(7797),I=n(6540),j=n(4848),z=(v=function(e){const t=new URLSearchParams;t.append("code",e);for(let e=1;e<arguments.length;e++)t.append("v",arguments[e]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})&&v.__esModule&&Object.prototype.hasOwnProperty.call(v,"default")?v.default:v;function N(e){const t=e.transform();return null!==t?new Set([t]):new Set}function k({initialEditor:e,children:t,initialNodes:n,initialTheme:r,skipCollabChecks:i}){const o=(0,I.useRef)(!1),s=(0,I.useContext)(E.Gu);null==s&&z(9);const[a,{getTheme:c}]=s,l=(0,I.useMemo)((()=>{const t=r||c()||void 0,i=(0,E.Mx)(s,t);if(void 0!==t&&(e._config.theme=t),e._parentEditor=a,n)for(let t of n){let n=null,r=null;if("function"!=typeof t){const e=t;t=e.replace,n=e.with,r=e.withKlass||null}const i=e._nodes.get(t.getType());e._nodes.set(t.getType(),{exportDOM:i?i.exportDOM:void 0,klass:t,replace:n,replaceWithKlass:r,transforms:N(t)})}else{const t=e._nodes=new Map(a._nodes);for(const[n,r]of t)e._nodes.set(n,{exportDOM:r.exportDOM,klass:r.klass,replace:r.replace,replaceWithKlass:r.replaceWithKlass,transforms:N(r.klass)})}return e._config.namespace=a._config.namespace,e._editable=a._editable,[e,i]}),[]),{isCollabActive:u,yjsDocMap:d}=(0,y.k)(),h=i||o.current||d.has(e.getKey());return(0,I.useEffect)((()=>{h&&(o.current=!0)}),[h]),(0,I.useEffect)((()=>a.registerEditableListener((t=>{e.setEditable(t)}))),[e,a]),(0,j.jsx)(E.Gu.Provider,{value:l,children:!u||h?t:null})}var R=n(4674),D=n(9393),W=n(3105),_=n(8832),T=n(7639),P=n(7501);const S="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBTVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xzIC0tPg0KPHN2ZyB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCiAgICA8cGF0aCBkPSJNMjIgM0gydjE4aDIwdi0yaC0ydi0yaDJ2LTJoLTJ2LTJoMnYtMmgtMlY5aDJWN2gtMlY1aDJWM3ptLTIgNHYyaC0ydjJoMnYyaC0ydjJoMnYyaC0ydjJINFY1aDE0djJoMnptLTYgMmgtMnYyaC0ydjJIOHYySDZ2Mmgydi0yaDJ2LTJoMnYtMmgydjJoMnYtMmgtMlY5ek02IDdoMnYySDZWN3oiIGZpbGw9IiMwMDAwMDAiLz4NCjwvc3ZnPg==";var L=n(79),Y=n(8968),H=n(8492),Z=n(3653),J=n(1238);function G(e,t,n){return Math.min(Math.max(e,t),n)}var O={east:1,north:8,south:2,west:4};function X(e){var t=e.onResizeStart,n=e.onResizeEnd,r=e.buttonRef,i=e.imageRef,o=e.maxWidth,s=e.editor,a=e.showCaption,c=e.setShowCaption,l=e.captionsEnabled,u=(0,I.useRef)(null),d=(0,I.useRef)({priority:"",value:"default"}),h=(0,I.useRef)({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),g=s.getRootElement(),p=o||(null!==g?g.getBoundingClientRect().width-20:100),f=null!==g?g.getBoundingClientRect().height-20:100,m=function(e,n){if(s.isEditable()){var r=i.current,o=u.current;if(null!==r&&null!==o){e.preventDefault();var a=r.getBoundingClientRect(),c=a.width,l=a.height,p=(0,W.OV)(r),f=h.current;f.startWidth=c,f.startHeight=l,f.ratio=c/l,f.currentWidth=c,f.currentHeight=l,f.startX=e.clientX/p,f.startY=e.clientY/p,f.isResizing=!0,f.direction=n,function(e){var t=e===O.east||e===O.west,n=e===O.north||e===O.south,r=e&O.north&&e&O.west||e&O.south&&e&O.east,i=t?"ew":n?"ns":r?"nwse":"nesw";null!==g&&g.style.setProperty("cursor","".concat(i,"-resize"),"important"),null!==document.body&&(document.body.style.setProperty("cursor","".concat(i,"-resize"),"important"),d.current.value=document.body.style.getPropertyValue("-webkit-user-select"),d.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))}(n),t(),o.classList.add("image-control-wrapper--resizing"),r.style.height="".concat(l,"px"),r.style.width="".concat(c,"px"),document.addEventListener("pointermove",A),document.addEventListener("pointerup",v)}}},A=function(e){var t=i.current,n=h.current,r=n.direction&(O.east|O.west),o=n.direction&(O.south|O.north);if(null!==t&&n.isResizing){var s=(0,W.OV)(t);if(r&&o){var a=Math.floor(n.startX-e.clientX/s);a=n.direction&O.east?-a:a;var c=G(n.startWidth+a,100,p),l=c/n.ratio;t.style.width="".concat(c,"px"),t.style.height="".concat(l,"px"),n.currentHeight=l,n.currentWidth=c}else if(o){var u=Math.floor(n.startY-e.clientY/s);u=n.direction&O.south?-u:u;var d=G(n.startHeight+u,100,f);t.style.height="".concat(d,"px"),n.currentHeight=d}else{var g=Math.floor(n.startX-e.clientX/s);g=n.direction&O.east?-g:g;var m=G(n.startWidth+g,100,p);t.style.width="".concat(m,"px"),n.currentWidth=m}}},v=function(){var e=i.current,t=h.current,r=u.current;if(null!==e&&null!==r&&t.isResizing){var o=t.currentWidth,s=t.currentHeight;t.startWidth=0,t.startHeight=0,t.ratio=0,t.startX=0,t.startY=0,t.currentWidth=0,t.currentHeight=0,t.isResizing=!1,r.classList.remove("image-control-wrapper--resizing"),null!==g&&g.style.setProperty("cursor","text"),null!==document.body&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",d.current.value,d.current.priority)),n(o,s),document.removeEventListener("pointermove",A),document.removeEventListener("pointerup",v)}};return(0,j.jsxs)("div",{ref:u,children:[!a&&l&&(0,j.jsx)("button",{className:"image-caption-button",ref:r,onClick:function(){c(!a)},children:"Add Caption"}),(0,j.jsx)("div",{className:"image-resizer image-resizer-n",onPointerDown:function(e){m(e,O.north)}}),(0,j.jsx)("div",{className:"image-resizer image-resizer-ne",onPointerDown:function(e){m(e,O.north|O.east)}}),(0,j.jsx)("div",{className:"image-resizer image-resizer-e",onPointerDown:function(e){m(e,O.east)}}),(0,j.jsx)("div",{className:"image-resizer image-resizer-se",onPointerDown:function(e){m(e,O.south|O.east)}}),(0,j.jsx)("div",{className:"image-resizer image-resizer-s",onPointerDown:function(e){m(e,O.south)}}),(0,j.jsx)("div",{className:"image-resizer image-resizer-sw",onPointerDown:function(e){m(e,O.south|O.west)}}),(0,j.jsx)("div",{className:"image-resizer image-resizer-w",onPointerDown:function(e){m(e,O.west)}}),(0,j.jsx)("div",{className:"image-resizer image-resizer-nw",onPointerDown:function(e){m(e,O.north|O.west)}})]})}var V=n(5095),K=n(7147),F=n(7578),U=n(432),$=new Set,q=(0,_.gu)("RIGHT_CLICK_IMAGE_COMMAND");function Q(e){var t=e.altText,n=e.className,r=e.imageRef,i=e.src,o=e.width,s=e.height,a=e.maxWidth,c=e.onError;return function(e){if(!$.has(e))throw new Promise((function(t){var n=new Image;n.src=e,n.onload=function(){$.add(e),t(null)},n.onerror=function(){$.add(e)}}))}(i),(0,j.jsx)("img",{className:n||void 0,src:i,alt:t,ref:r,style:{height:s,maxWidth:a,width:o},onError:c,draggable:"false"})}function ee(){return(0,j.jsx)("img",{src:S,style:{height:200,opacity:.2,width:200},draggable:"false"})}function te(e){var t=e.src,n=e.altText,i=e.nodeKey,o=e.width,s=e.height,a=e.maxWidth,c=e.resizable,l=e.showCaption,u=e.caption,d=e.captionsEnabled,h=(0,I.useRef)(null),g=(0,I.useRef)(null),p=(0,D.Y)(i),f=(0,r.A)(p,3),m=f[0],A=f[1],v=f[2],z=(0,I.useState)(!1),N=(0,r.A)(z,2),S=N[0],G=N[1],O=((0,y.k)().isCollabActive,(0,E.DF)()),$=(0,r.A)(O,1)[0],te=(0,I.useState)(null),ne=(0,r.A)(te,2),re=ne[0],ie=ne[1],oe=(0,I.useRef)(null),se=(0,I.useState)(!1),ae=(0,r.A)(se,2),ce=ae[0],le=ae[1],ue=(0,I.useCallback)((function(e){if(m&&(0,_.RT)((0,_.vJ)())){e.preventDefault();var t=(0,_.ns)(i);if((0,F.Eh)(t))return t.remove(),!0}return!1}),[m,i]),de=(0,I.useCallback)((function(e){var t=(0,_.vJ)(),n=g.current;if(m&&(0,_.RT)(t)&&1===t.getNodes().length){if(l)return(0,_.n1)(null),e.preventDefault(),u.focus(),!0;if(null!==n&&n!==document.activeElement)return e.preventDefault(),n.focus(),!0}return!1}),[u,m,l]),he=(0,I.useCallback)((function(e){return(oe.current===u||g.current===e.target)&&((0,_.n1)(null),$.update((function(){A(!0);var e=$.getRootElement();null!==e&&e.focus()})),!0)}),[u,$,A]),ge=(0,I.useCallback)((function(e){var t=e;return!!S||t.target===h.current&&(t.shiftKey?A(!m):(v(),A(!0)),!0)}),[S,m,A,v]),pe=(0,I.useCallback)((function(e){$.getEditorState().read((function(){var t=(0,_.vJ)();"IMG"===e.target.tagName&&(0,_.I2)(t)&&1===t.getNodes().length&&$.dispatchCommand(q,e)}))}),[$]);(0,I.useEffect)((function(){var e=!0,t=$.getRootElement(),n=(0,W.Sd)($.registerUpdateListener((function(t){var n=t.editorState;e&&ie(n.read((function(){return(0,_.vJ)()})))})),$.registerCommand(_.Mv,(function(e,t){return oe.current=t,!1}),_.Ac),$.registerCommand(_.d8,ge,_.Ac),$.registerCommand(q,ge,_.Ac),$.registerCommand(_.Tg,(function(e){return e.target===h.current&&(e.preventDefault(),!0)}),_.Ac),$.registerCommand(_.w$,ue,_.Ac),$.registerCommand(_.gC,ue,_.Ac),$.registerCommand(_.if,de,_.Ac),$.registerCommand(_.Q$,he,_.Ac));return null==t||t.addEventListener("contextmenu",pe),function(){e=!1,n(),null==t||t.removeEventListener("contextmenu",pe)}}),[v,$,S,m,i,ue,de,he,ge,pe,A]);var fe=(0,P.O)().historyState,me=((0,T.t)().settings.showNestedEditorTreeView,m&&(0,_.RT)(re)&&!S),Ae=m||S;return(0,j.jsx)(I.Suspense,{fallback:null,children:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{draggable:me,children:ce?(0,j.jsx)(ee,{}):(0,j.jsx)(Q,{className:Ae?"focused ".concat((0,_.RT)(re)?"draggable":""):null,src:t,altText:n,imageRef:h,width:o,height:s,maxWidth:a,onError:function(){return le(!0)}})}),l&&(0,j.jsx)("div",{className:"image-caption-container",children:(0,j.jsxs)(k,{initialEditor:u,initialNodes:[_.h,_.Ey,_.GR,_.fD,x.Db,K.Hf,w.ZZ,U.UZ],children:[(0,j.jsx)(C.x,{}),(0,j.jsx)(Z.A,{}),(0,j.jsx)(H.A,{}),(0,j.jsx)(L.A,{}),(0,j.jsx)(B.E,{}),(0,j.jsx)(Y.A,{}),(0,j.jsx)(M.G,{externalHistoryState:fe}),(0,j.jsx)(R.$,{contentEditable:(0,j.jsx)(J.A,{className:"ImageNode__contentEditable"}),placeholder:(0,j.jsx)(V.A,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:b.R})]})}),c&&(0,_.RT)(re)&&Ae&&(0,j.jsx)(X,{showCaption:l,setShowCaption:function(){$.update((function(){var e=(0,_.ns)(i);(0,F.Eh)(e)&&e.setShowCaption(!0)}))},editor:$,buttonRef:g,imageRef:h,maxWidth:a,onResizeStart:function(){G(!0)},onResizeEnd:function(e,t){setTimeout((function(){G(!1)}),200),$.update((function(){var n=(0,_.ns)(i);(0,F.Eh)(n)&&n.setWidthAndHeight(e,t)}))},captionsEnabled:!ce&&d})]})})}},2756:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(1354),i=n.n(r),o=n(6314),s=n.n(o)()(i());s.push([e.id,"/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n *\n */\n\n.ImageNode__contentEditable {\n  min-height: 30px;\n  border: 0px;\n  resize: none;\n  cursor: text;\n  caret-color: rgb(5, 5, 5);\n  display: block;\n  position: relative;\n  outline: 0px;\n  padding: 10px;\n  user-select: text;\n  font-size: 12px;\n  width: calc(100% - 20px);\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n\n.ImageNode__placeholder {\n  font-size: 12px;\n  color: #888;\n  overflow: hidden;\n  position: absolute;\n  text-overflow: ellipsis;\n  top: 10px;\n  left: 10px;\n  user-select: none;\n  white-space: nowrap;\n  display: inline-block;\n  pointer-events: none;\n}\n\n.image-control-wrapper--resizing {\n  touch-action: none;\n}\n","",{version:3,sources:["webpack://./src/LexicalEditor/nodes/ImageNode.css"],names:[],mappings:"AAAA;;;;;;;EAOE;;AAEF;EACE,gBAAgB;EAChB,WAAW;EACX,YAAY;EACZ,YAAY;EACZ,yBAAyB;EACzB,cAAc;EACd,kBAAkB;EAClB,YAAY;EACZ,aAAa;EACb,iBAAiB;EACjB,eAAe;EACf,wBAAwB;EACxB,qBAAqB;EACrB,sBAAsB;AACxB;;AAEA;EACE,eAAe;EACf,WAAW;EACX,gBAAgB;EAChB,kBAAkB;EAClB,uBAAuB;EACvB,SAAS;EACT,UAAU;EACV,iBAAiB;EACjB,mBAAmB;EACnB,qBAAqB;EACrB,oBAAoB;AACtB;;AAEA;EACE,kBAAkB;AACpB",sourcesContent:["/**\r\n * Copyright (c) Meta Platforms, Inc. and affiliates.\r\n *\r\n * This source code is licensed under the MIT license found in the\r\n * LICENSE file in the root directory of this source tree.\r\n *\r\n *\r\n */\r\n\r\n.ImageNode__contentEditable {\r\n  min-height: 30px;\r\n  border: 0px;\r\n  resize: none;\r\n  cursor: text;\r\n  caret-color: rgb(5, 5, 5);\r\n  display: block;\r\n  position: relative;\r\n  outline: 0px;\r\n  padding: 10px;\r\n  user-select: text;\r\n  font-size: 12px;\r\n  width: calc(100% - 20px);\r\n  white-space: pre-wrap;\r\n  word-break: break-word;\r\n}\r\n\r\n.ImageNode__placeholder {\r\n  font-size: 12px;\r\n  color: #888;\r\n  overflow: hidden;\r\n  position: absolute;\r\n  text-overflow: ellipsis;\r\n  top: 10px;\r\n  left: 10px;\r\n  user-select: none;\r\n  white-space: nowrap;\r\n  display: inline-block;\r\n  pointer-events: none;\r\n}\r\n\r\n.image-control-wrapper--resizing {\r\n  touch-action: none;\r\n}\r\n"],sourceRoot:""}]);const a=s}}]);
//# sourceMappingURL=299.lexical.embed.js.map